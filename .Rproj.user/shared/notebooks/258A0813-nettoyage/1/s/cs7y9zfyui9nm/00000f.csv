"0",""
"0",""
"0",""
"0","depts_cibles_noms <- c(""Paris"", ""Hauts-de-Seine"", ""Seine-Saint-Denis"", ""Val-de-Marne"")"
"0",""
"0",""
"0","# 1.1 Préparation des données ÉGAPRO (en partant du dataframe `data`)"
"0","#------------------------------------------------------------------"
"0","egapro_clean <- data %>%"
"0","  # 1. Nettoyer les noms de colonnes (on sait maintenant exactement ce que ça produit)"
"0","  clean_names() %>%"
"0","  "
"0","  # 2. Remplacer ""NC"" par NA, UNIQUEMENT dans les colonnes de type texte."
"0","  mutate(across(where(is.character), ~na_if(., ""NC""))) %>%"
"0",""
"0","  # 3. Filtrer pour ne garder que les lignes pertinentes"
"0","  filter("
"0","    annee == 2024,"
"0","    structure == ""Entreprise"","
"0","    departement %in% depts_cibles_noms"
"0","  ) %>%"
"0","  "
"0","  # 4. Convertir et unifier les colonnes de notes et l'index en numérique"
"0","  #    en utilisant les NOMS EXACTS de tes colonnes."
"0","  mutate("
"0","    index = as.numeric(note_index),"
"0","    note_remuneration = as.numeric(note_ecart_remuneration),"
"0","    "
"0","    # On unifie les deux colonnes d'augmentation en une seule colonne fiable"
"0","    # avec la bonne orthographe."
"0","    note_augmentation = coalesce("
"0","      as.numeric(note_ecart_taux_daugmentation),"
"0","      as.numeric(note_ecart_taux_daugmentation_hors_promotion)"
"0","    ),"
"0","    "
"0","    note_promotion = as.numeric(note_ecart_taux_de_promotion),"
"0","    note_conge_mat = as.numeric(note_retour_conge_maternite),"
"0","    note_hautes_rem = as.numeric(note_hautes_remunerations)"
"0","  ) %>%"
"0","  "
"0","  # 5. Filtrer à nouveau pour ne garder que les entreprises avec un score VALIDE"
"0","  filter(!is.na(index)) %>%"
"0","  "
"0","  # 6. Assurer le bon format du SIREN pour la jointure"
"0","  mutate(siren = str_pad(siren, 9, side = ""left"", pad = ""0"")) %>%"
"0","  "
"0","  # 7. Sélectionner les colonnes finales. On utilise ici 'tranche_deffectifs'."
"0","  select("
"0","    siren,"
"0","    raison_sociale,"
"0","    tranche_effectifs = tranche_deffectifs, # Correction du nom"
"0","    region,"
"0","    departement,"
"0","    index,"
"0","    note_remuneration,"
"0","    note_augmentation,"
"0","    note_promotion,"
"0","    note_conge_mat,"
"0","    note_hautes_rem"
"0","  ) %>%"
"0","  "
"0","  # 8. S'assurer de l'unicité par SIREN"
"0","  distinct(siren, .keep_all = TRUE)"
"0",""
"0","# -- Vérification finale --"
"0","cat(""✅ Égapro nettoyé et formaté :"", nrow(egapro_clean), ""entreprises uniques pour 2024 avec un score numérique valide.\n\n"")"
"1","✅ Égapro nettoyé et formaté :"
"1"," "
"1","4727"
"1"," "
"1","entreprises uniques pour 2024 avec un score numérique valide.

"

"0","# La clé pour la pondération"
"0","eff_key_geo <- c(""50 à 250"" = 150, ""251 à 999"" = 625, ""1000 et plus"" = 1500)"
"0",""
"0","# Le code EPT de Paris est celui de la Métropole du Grand Paris"
"0","# Les autres sont des EPT. On va donc grouper par nom_epci."
"0","agg_ept <- master_df_final %>%"
"0","  # On crée le poids"
"0","  mutate(poids = eff_key_geo[tranche_effectifs] |> unname()) %>%"
"0","  "
"0","  # On groupe par le nom de l'EPCI (qui est le nom de l'EPT ou ""Métropole du Grand Paris"")"
"0","  group_by(nom_epci) %>%"
"0","  "
"0","  # On calcule nos agrégats"
"0","  summarise("
"0","    n_entreprises = n(),"
"0","    score_egapro_moyen = weighted.mean(index, poids, na.rm = TRUE),"
"0","    part_cadres_total_moyenne = weighted.mean(part_cadres_total, poids, na.rm = TRUE),"
"0","    tx_tps_partiel_femmes_moyen = weighted.mean(tx_tps_partiel_femmes, poids, na.rm = TRUE),"
"0","    .groups = ""drop"""
"0","  ) %>%"
"0","  # On enlève les territoires avec trop peu d'entreprises pour que ce soit significatif"
"0","  filter(n_entreprises > 10) %>%"
"0","  arrange(desc(score_egapro_moyen))"
"0",""
"0","# Afficher le résultat !"
"0","print(agg_ept)"
